var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},BoxR;(function(n){var t=!1,r,u,f,i,e,o;r=function(){function n(n,t,i){this.active=!1,this.ctx=n,this.x=t,this.y=i}return n.prototype.Draw=function(){},n.prototype.Click=function(){return new i(!1,0)},n}(),n.Drawable=r,u=function(n){function t(t,i,r,u,f,e){n.call(this,t,i,r),this.width=u,this.height=f,this.isHorizontal=e,this.squeres=[],this.mouseover=!1}return __extends(t,n),t.prototype.Draw=function(){this.ctx.strokeStyle="black",this.ctx.fillStyle=this.active?"darkslateblue":this.mouseover?"rgb(27,161,226)":"slateblue",this.ctx.beginPath(),this.isHorizontal?(this.ctx.moveTo(this.x+this.width/6,this.y),this.ctx.lineTo(this.x+this.width*5/6,this.y),this.ctx.lineTo(this.x+this.width,this.y+this.height/2),this.ctx.lineTo(this.x+this.width*5/6,this.y+this.height),this.ctx.lineTo(this.x+this.width/6,this.y+this.height),this.ctx.lineTo(this.x,this.y+this.height/2)):(this.ctx.moveTo(this.x+this.width/2,this.y),this.ctx.lineTo(this.x+this.width,this.y+this.height/6),this.ctx.lineTo(this.x+this.width,this.y+this.height*5/6),this.ctx.lineTo(this.x+this.width/2,this.y+this.height),this.ctx.lineTo(this.x,this.y+this.height*5/6),this.ctx.lineTo(this.x,this.y+this.height/6)),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke(),this.ctx.closePath()},t.prototype.MouseOver=function(n,t){this.active||(n>=this.x&&n<=this.x+this.width&&t>=this.y&&t<=this.y+this.height?(this.mouseover=!0,this.Draw()):this.mouseover&&(this.mouseover=!1,this.Draw()),this.ctx.stroke())},t.prototype.AddSquere=function(n){this.squeres.push(n)},t.prototype.Click=function(n,t){return this.active?new i(!1,0):n>=this.x&&n<=this.x+this.width&&t>=this.y&&t<=this.y+this.height?new i(!0,this.Activate()):new i(!1,0)},t.prototype.Activate=function(){this.active=!0;var n=0;return this.squeres.forEach(function(t){t.EdgeChecked()&&n++}),n},t}(r),n.Edge=u,f=function(n){function i(t,i,r,u){n.call(this,t,i,r),this.width=u,this.animated=!1,this.Edges=[]}return __extends(i,n),i.prototype.EdgeChecked=function(){return this.EdgesChecked()==4?(this.active=!0,this.color=t?"27,161,226,":"290,20,0,",!0):!1},i.prototype.EdgesChecked=function(){for(var t=0,n=0;n<this.Edges.length;n++)t+=this.Edges[n].active?1:0;return t},i.prototype.Draw=function(){if(this.active)if(this.animated)this.ctx.fillStyle="rgba("+this.color+"1)",this.ctx.strokeStyle="black",this.ctx.beginPath(),this.ctx.rect(this.x,this.y,this.width,this.width),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke();else{this.color=t?"27,161,226,":"290,20,0,";var r=120,i=0,n=this,u=setInterval(function(){n.ctx.fillStyle="rgba("+n.color+i/r+")",n.ctx.strokeStyle="black",n.ctx.beginPath(),n.ctx.rect(n.x,n.y,n.width,n.width),n.ctx.closePath(),n.ctx.fill(),n.ctx.stroke(),i++,i===r&&clearInterval(u)},30);this.animated=!0}},i}(r),n.Squere=f,i=function(){function n(n,t){this.EdgeActivated=n,this.SquereActivated=t}return n}(),n.ClickResponse=i,e=function(){function n(n,t){this.x=n,this.y=t}return n}(),n.Coordinate=e,o=function(){function i(n,t){typeof t=="undefined"&&(t=!1),this.ctx=n.getContext("2d"),this.LeftOffset=n.offsetLeft,this.TopOffset=n.getBoundingClientRect().top,this.Width=n.clientWidth,this.IsSinglePlayer=t}return i.prototype.Init=function(i,r){var e,c,p,o,h;this.n=i,this.Clear(),this.Edges=[],this.Squares=[];var a=7,s=this.Width/(i*a+(i+1)+2),v=[s,2*s],y=[2*s,s],l=a*s,w=[l,s],b=[s,l];for(e=0;e<2*i+1;e++)for(this.Edges[e]=[],this.Squares[e/2-1]=[],c=e%2,p=c==0?i:i+1,o=0;o<p;o++)this.Edges[e][o]=new u(this.ctx,y[c]+o*(l+s),v[c]+Math.floor(e/2)*(l+s),w[c],b[c],c==0),c==0&&e>0&&(h=new f(this.ctx,y[0]+o*(s+l)+s/2,v[1]+(e-2)/2*(l+s)+s/2,l-s),this.Squares[e/2-1][o]=h,this.Edges[e][o].AddSquere(h),this.Edges[e-1][o+1].AddSquere(h),this.Edges[e-2][o].AddSquere(h),this.Edges[e-1][o].AddSquere(h),h.Edges.push(this.Edges[e][o]),h.Edges.push(this.Edges[e-1][o+1]),h.Edges.push(this.Edges[e-2][o]),h.Edges.push(this.Edges[e-1][o]));t=r,this.selfScore=0,this.opponentScore=0,this.IsSinglePlayer||n.Manager.Server.UpdateRound(t)},i.prototype.Draw=function(){this.Clear(),this.Edges.forEach(function(n){n.forEach(function(n){n.Draw()})}),this.Squares.forEach(function(n){n.forEach(function(n){n.Draw()})})},i.prototype.Clear=function(){this.ctx.clearRect(0,0,this.ctx.canvas.clientWidth,this.ctx.canvas.clientWidth)},i.prototype.Click=function(i){var u,f,r;t&&(u=i.pageX-this.LeftOffset,f=i.pageY-this.TopOffset,i.pageX&&i.pageY||(u=i.x-this.LeftOffset,f=i.y-this.TopOffset),r=this,this.Edges.forEach(function(t,i){t.forEach(function(t,e){var o=t.Click(u,f);if(o.EdgeActivated){r.IsSinglePlayer||n.Manager.Hub.server.edgeClicked(i,e),r.selfScore+=o.SquereActivated,o.SquereActivated==0?r.NextRound():r.UpdateScore(),r.Draw();return}})}))},i.prototype.MouseMove=function(n){if(t){var i=n.clientX-this.LeftOffset,r=n.clientY-this.TopOffset;this.Edges.forEach(function(n){n.forEach(function(n){n.MouseOver(i,r)})}),this.Draw()}},i.prototype.EdgeClickFromServerByCoordinate=function(n,t){if(!this.Edges[n][t].active){var i=this.Edges[n][t].Activate();this.opponentScore+=i,i==0?this.NextRound():this.UpdateScore(),this.Draw()}},i.prototype.EdgeClickFromServerByEdge=function(n){var t=this,i;return n.active?!1:(i=n.Activate(),t.opponentScore+=i,i==0?(t.Draw(),!1):(t.UpdateScore(),t.Draw(),!0))},i.prototype.UpdateScore=function(){if(this.IsSinglePlayer||(n.Manager.Server.UpdateSelfScore(this.selfScore),n.Manager.Server.UpdateOpponentScore(this.opponentScore)),this.selfScore+this.opponentScore==this.n*this.n){this.IsSinglePlayer||n.Manager.Hub.server.finishGame(),this.selfScore>this.opponentScore?n.Manager.Client.WinPopup():n.Manager.Client.LosePopup();return}},i.prototype.NextRound=function(){t^=!0,this.IsSinglePlayer?t||this.MachineClick():n.Manager.Server.UpdateRound(t)},i.prototype.MachineClick=function(){var n=this;setTimeout(function(){var t=n.FourthClick()||n.CleverClick(0),i=n.EdgeClickFromServerByEdge(t);i?n.MachineClick():n.NextRound()},1e3)},i.prototype.CleverClick=function(n){for(var e=!1,i=[],r,f,u,t=0;t<this.Edges.length;t++)for(r=0;r<this.Edges[t].length;r++)this.Edges[t][r].active||i.push(this.Edges[t][r]);while(!e&&i.length>0){if(f=Math.floor(Math.random()*i.length),u=i[f],u.squeres[0].EdgesChecked()<=n&&(u.squeres.length==1||u.squeres[1].EdgesChecked()<=n))return u;i.splice(f,1)}if(!e)return this.CleverClick(n+1)},i.prototype.FourthClick=function(){for(var i=!1,f,r,t,u,n=0;n<this.Squares.length&&!i;n++)for(r=0;r<this.Squares[n].length&&!i;r++)if(t=this.Squares[n][r],t.EdgesChecked()==3)for(u=0;u<t.Edges.length;u++)t.Edges[u].active||(f=t,i=!0);return i?f:null},i}(),n.Game=o})(BoxR||(BoxR={}))