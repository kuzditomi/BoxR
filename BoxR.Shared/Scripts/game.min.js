var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},selfRound=!1,Drawable=function(){function n(n,t,i){this.active=!1,this.ctx=n,this.x=t,this.y=i}return n.prototype.Draw=function(){},n.prototype.Click=function(){return new ClickResponse(!1,0)},n}(),ClickResponse=function(){function n(n,t){this.EdgeActivated=n,this.SquereActivated=t}return n}(),Edge=function(n){function t(t,i,r,u,f,e){n.call(this,t,i,r),this.width=u,this.height=f,this.isHorizontal=e,this.squeres=[],this.mouseover=!1}return __extends(t,n),t.prototype.Draw=function(){this.ctx.strokeStyle="black",this.ctx.fillStyle=this.active?"darkslateblue":this.mouseover?"rgb(27,161,226)":"slateblue",this.ctx.beginPath(),this.isHorizontal?(this.ctx.moveTo(this.x+this.width/6,this.y),this.ctx.lineTo(this.x+this.width*5/6,this.y),this.ctx.lineTo(this.x+this.width,this.y+this.height/2),this.ctx.lineTo(this.x+this.width*5/6,this.y+this.height),this.ctx.lineTo(this.x+this.width/6,this.y+this.height),this.ctx.lineTo(this.x,this.y+this.height/2)):(this.ctx.moveTo(this.x+this.width/2,this.y),this.ctx.lineTo(this.x+this.width,this.y+this.height/6),this.ctx.lineTo(this.x+this.width,this.y+this.height*5/6),this.ctx.lineTo(this.x+this.width/2,this.y+this.height),this.ctx.lineTo(this.x,this.y+this.height*5/6),this.ctx.lineTo(this.x,this.y+this.height/6)),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke(),this.ctx.closePath()},t.prototype.MouseOver=function(n,t){this.active||(n>=this.x&&n<=this.x+this.width&&t>=this.y&&t<=this.y+this.height?(this.mouseover=!0,this.Draw()):this.mouseover&&(this.mouseover=!1,this.Draw()),this.ctx.stroke())},t.prototype.AddSquere=function(n){this.squeres.push(n)},t.prototype.Click=function(n,t){return this.active?new ClickResponse(!1,0):n>=this.x&&n<=this.x+this.width&&t>=this.y&&t<=this.y+this.height?new ClickResponse(!0,this.Activate()):new ClickResponse(!1,0)},t.prototype.Activate=function(){this.active=!0;var n=0;return this.squeres.forEach(function(t){t.EdgeChecked()&&n++}),n},t}(Drawable),Squere=function(n){function t(t,i,r,u){n.call(this,t,i,r),this.edgesChecked=0,this.width=u,this.animated=!1}return __extends(t,n),t.prototype.EdgeChecked=function(){return(this.edgesChecked++,this.edgesChecked==4)?(this.active=!0,!0):!1},t.prototype.Draw=function(){if(this.active)if(this.animated)this.ctx.fillStyle="rgba("+this.color+"1)",this.ctx.strokeStyle="black",this.ctx.beginPath(),this.ctx.rect(this.x,this.y,this.width,this.width),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke();else{this.color=selfRound?"27,161,226,":"290,20,0,";var i=120,t=0,n=this,r=setInterval(function(){n.ctx.fillStyle="rgba("+n.color+t/i+")",n.ctx.strokeStyle="black",n.ctx.beginPath(),n.ctx.rect(n.x,n.y,n.width,n.width),n.ctx.closePath(),n.ctx.fill(),n.ctx.stroke(),t++,t===i&&clearInterval(r)},30);this.animated=!0}},t}(Drawable),Game=function(){function n(n){this.ctx=n.getContext("2d"),this.LeftOffset=n.getBoundingClientRect().left,this.TopOffset=n.getBoundingClientRect().top,this.Width=n.clientWidth}return n.prototype.Init=function(n,t){var r,f,l,u,o;this.n=n,this.Clear(),this.edges=[],this.squares=[];var s=7,i=this.Width/(n*s+(n+1)+2),h=[i,2*i],c=[2*i,i],e=s*i,a=[e,i],v=[i,e];for(r=0;r<2*n+1;r++)for(this.edges[r]=[],f=r%2,l=f==0?n:n+1,u=0;u<l;u++)this.edges[r][u]=new Edge(this.ctx,c[f]+u*(e+i),h[f]+Math.floor(r/2)*(e+i),a[f],v[f],f==0),f==0&&r>0&&(o=new Squere(this.ctx,c[0]+u*(i+e)+i/2,h[1]+(r-2)/2*(e+i)+i/2,e-i),this.squares.push(o),this.edges[r][u].AddSquere(o),this.edges[r-1][u+1].AddSquere(o),this.edges[r-2][u].AddSquere(o),this.edges[r-1][u].AddSquere(o));selfRound=t,this.selfScore=0,this.opponentScore=0,updateRound(selfRound)},n.prototype.Draw=function(){this.Clear(),this.edges.forEach(function(n){n.forEach(function(n){n.Draw()})}),this.squares.forEach(function(n){n.Draw()})},n.prototype.Clear=function(){this.ctx.clearRect(0,0,this.ctx.canvas.clientWidth,this.ctx.canvas.clientWidth)},n.prototype.Click=function(n){var i,r,t;selfRound&&(i=n.pageX-this.LeftOffset,r=n.pageY-this.TopOffset,n.pageX&&n.pageY||(i=n.x-this.LeftOffset,r=n.y-this.TopOffset),t=this,this.edges.forEach(function(n,u){n.forEach(function(n,f){var e=n.Click(i,r);if(e.EdgeActivated){gameHub.server.edgeClicked(u,f),t.selfScore+=e.SquereActivated,e.SquereActivated==0?t.NextRound():t.UpdateScore(),t.Draw();return}})}))},n.prototype.MouseMove=function(n){if(selfRound){var t=n.clientX-this.LeftOffset,i=n.clientY-this.TopOffset;this.edges.forEach(function(n){n.forEach(function(n){n.MouseOver(t,i)})}),this.Draw()}},n.prototype.EdgeClickFromServer=function(n,t){if(!this.edges[n][t].active){var i=this.edges[n][t].Activate();this.opponentScore+=i,i==0?this.NextRound():this.UpdateScore(),this.Draw()}},n.prototype.UpdateScore=function(){if(updateSelfScore(this.selfScore),updateOpponentScore(this.opponentScore),this.selfScore+this.opponentScore==this.n*this.n){this.selfScore>this.opponentScore?win_popup():lose_popup();return}},n.prototype.NextRound=function(){selfRound^=!0,updateRound(selfRound)},n}()