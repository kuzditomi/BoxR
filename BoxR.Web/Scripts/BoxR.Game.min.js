var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},BoxR;(function(n){var t=!1,r,i,u,f,e;r=function(){function n(n,t,i){this.active=!1,this.ctx=n,this.x=t,this.y=i}return n.prototype.Draw=function(){},n.prototype.Click=function(){return new i(!1,0)},n}(),n.Drawable=r,i=function(){function n(n,t){this.EdgeActivated=n,this.SquereActivated=t}return n}(),n.ClickResponse=i,u=function(n){function t(t,i,r,u,f,e){n.call(this,t,i,r),this.width=u,this.height=f,this.isHorizontal=e,this.squeres=[],this.mouseover=!1}return __extends(t,n),t.prototype.Draw=function(){this.ctx.strokeStyle="black",this.ctx.fillStyle=this.active?"darkslateblue":this.mouseover?"rgb(27,161,226)":"slateblue",this.ctx.beginPath(),this.isHorizontal?(this.ctx.moveTo(this.x+this.width/6,this.y),this.ctx.lineTo(this.x+this.width*5/6,this.y),this.ctx.lineTo(this.x+this.width,this.y+this.height/2),this.ctx.lineTo(this.x+this.width*5/6,this.y+this.height),this.ctx.lineTo(this.x+this.width/6,this.y+this.height),this.ctx.lineTo(this.x,this.y+this.height/2)):(this.ctx.moveTo(this.x+this.width/2,this.y),this.ctx.lineTo(this.x+this.width,this.y+this.height/6),this.ctx.lineTo(this.x+this.width,this.y+this.height*5/6),this.ctx.lineTo(this.x+this.width/2,this.y+this.height),this.ctx.lineTo(this.x,this.y+this.height*5/6),this.ctx.lineTo(this.x,this.y+this.height/6)),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke(),this.ctx.closePath()},t.prototype.MouseOver=function(n,t){this.active||(n>=this.x&&n<=this.x+this.width&&t>=this.y&&t<=this.y+this.height?(this.mouseover=!0,this.Draw()):this.mouseover&&(this.mouseover=!1,this.Draw()),this.ctx.stroke())},t.prototype.AddSquere=function(n){this.squeres.push(n)},t.prototype.Click=function(n,t){return this.active?new i(!1,0):n>=this.x&&n<=this.x+this.width&&t>=this.y&&t<=this.y+this.height?new i(!0,this.Activate()):new i(!1,0)},t.prototype.Activate=function(){this.active=!0;var n=0;return this.squeres.forEach(function(t){t.EdgeChecked()&&n++}),n},t}(r),n.Edge=u,f=function(n){function i(t,i,r,u){n.call(this,t,i,r),this.edgesChecked=0,this.width=u,this.animated=!1}return __extends(i,n),i.prototype.EdgeChecked=function(){return(this.edgesChecked++,this.edgesChecked==4)?(this.active=!0,!0):!1},i.prototype.Draw=function(){if(this.active)if(this.animated)this.ctx.fillStyle="rgba("+this.color+"1)",this.ctx.strokeStyle="black",this.ctx.beginPath(),this.ctx.rect(this.x,this.y,this.width,this.width),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke();else{this.color=t?"27,161,226,":"290,20,0,";var r=120,i=0,n=this,u=setInterval(function(){n.ctx.fillStyle="rgba("+n.color+i/r+")",n.ctx.strokeStyle="black",n.ctx.beginPath(),n.ctx.rect(n.x,n.y,n.width,n.width),n.ctx.closePath(),n.ctx.fill(),n.ctx.stroke(),i++,i===r&&clearInterval(u)},30);this.animated=!0}},i}(r),n.Squere=f,e=function(){function n(n,t,i){this.ctx=n.getContext("2d"),this.LeftOffset=n.getBoundingClientRect().left,this.TopOffset=n.getBoundingClientRect().top,this.Width=n.clientWidth,this.server=t,this.client=i}return n.prototype.Init=function(n,i){var e,s,y,o,c;this.n=n,this.Clear(),this.edges=[],this.squares=[];var l=7,r=this.Width/(n*l+(n+1)+2),a=[r,2*r],v=[2*r,r],h=l*r,p=[h,r],w=[r,h];for(e=0;e<2*n+1;e++)for(this.edges[e]=[],s=e%2,y=s==0?n:n+1,o=0;o<y;o++)this.edges[e][o]=new u(this.ctx,v[s]+o*(h+r),a[s]+Math.floor(e/2)*(h+r),p[s],w[s],s==0),s==0&&e>0&&(c=new f(this.ctx,v[0]+o*(r+h)+r/2,a[1]+(e-2)/2*(h+r)+r/2,h-r),this.squares.push(c),this.edges[e][o].AddSquere(c),this.edges[e-1][o+1].AddSquere(c),this.edges[e-2][o].AddSquere(c),this.edges[e-1][o].AddSquere(c));t=i,this.selfScore=0,this.opponentScore=0,this.server.UpdateRound(t)},n.prototype.Draw=function(){this.Clear(),this.edges.forEach(function(n){n.forEach(function(n){n.Draw()})}),this.squares.forEach(function(n){n.Draw()})},n.prototype.Clear=function(){this.ctx.clearRect(0,0,this.ctx.canvas.clientWidth,this.ctx.canvas.clientWidth)},n.prototype.Click=function(n){var r,u,i;t&&(r=n.pageX-this.LeftOffset,u=n.pageY-this.TopOffset,n.pageX&&n.pageY||(r=n.x-this.LeftOffset,u=n.y-this.TopOffset),i=this,this.edges.forEach(function(n,t){n.forEach(function(n,f){var e=n.Click(r,u);if(e.EdgeActivated){i.server.gameHub.server.edgeClicked(t,f),i.selfScore+=e.SquereActivated,e.SquereActivated==0?i.NextRound():i.UpdateScore(),i.Draw();return}})}))},n.prototype.MouseMove=function(n){if(t){var i=n.clientX-this.LeftOffset,r=n.clientY-this.TopOffset;this.edges.forEach(function(n){n.forEach(function(n){n.MouseOver(i,r)})}),this.Draw()}},n.prototype.EdgeClickFromServer=function(n,t){if(!this.edges[n][t].active){var i=this.edges[n][t].Activate();this.opponentScore+=i,i==0?this.NextRound():this.UpdateScore(),this.Draw()}},n.prototype.UpdateScore=function(){if(this.server.UpdateSelfScore(this.selfScore),this.server.UpdateOpponentScore(this.opponentScore),this.selfScore+this.opponentScore==this.n*this.n){this.server.gameHub.server.finishGame(),this.selfScore>this.opponentScore?this.client.WinPopup():this.client.LosePopup();return}},n.prototype.NextRound=function(){t^=!0,this.server.UpdateRound(t)},n}(),n.Game=e})(BoxR||(BoxR={}))